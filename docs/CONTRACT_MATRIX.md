# CONTRACT_MATRIX

| Endpoint | Current Request/Response | Required Fields | Gap to Address |
| --- | --- | --- | --- |
| POST /api/bookings | Request body per `createBookingDto` (destination, startDate/endDate, travelers, totalPrice, type [STANDARD/CUSTOMIZED/REQUESTED], tourType, itinerary[]). Response returns booking with embedded itinerary and no bookingCode. | Itinerary + booking separation; bookingCode format BV-YYYY-NNNNN; type must include SMART_TRIP; normalized ISO datetimes. | Needs new itinerary entity/DTOs, booking code generator, SMART_TRIP support, ISO serialization. |
| GET /api/bookings/my-bookings | Query: page, limit, status. Response: list of bookings with nested itinerary + metadata. | Filter by itinerary/booking type, include bookingCode, normalized dates, collaborator visibility. | Add itinerary linkage and type-aware filtering; ensure ISO dates and bookingCode are returned. |
| GET /api/bookings/:id | Params: id (uuid). Response: booking with itinerary, collaborators, payments. | Same shape as new DTOs; enforce access for owner/collaborator/admin; include bookingCode and itinerary state. | Needs DTO remap after refactor; add bookingCode + itinerary separation and standardized timestamps. |
| PATCH /api/bookings/:id/submit | Params: id. Body: none. Moves DRAFTâ†’PENDING. | Flow-specific status transitions based on itinerary type (requested vs standard/custom/smart). | Add itinerary type aware lifecycle and requested flow handling; include notifications. |
| PATCH /api/bookings/:id/status (admin) | Body: status + optional rejectionReason/resolution. | Approve/reject with structured notifications; status rules tied to itinerary/booking separation. | Add notification payloads and lifecycle validation per itinerary flow. |
| POST /api/bookings/:id/payments | Body includes payment details; proof stored as bytes fields. | Should attach to booking code reference, accept receipt metadata, trigger notification. | Map to bookingCode, enforce ISO timestamps, add notification hooks. |
| GET /api/weather/forecast | Query: lat,lng. Returns raw OpenWeather forecast or mock `{forecast: [...]}`. | Normalized forecast array with date/time strings and summary fields. | Standardize DTO regardless of external API and ensure consistent fields. |
| (missing) GET /api/faqs | Not implemented. | Should return list of FAQs with question/answer/order/visibility. | Add route/controller/service + schema. |
| (missing) POST /api/upload/itinerary-thumbnail | Not implemented. | Accept multipart/simulated upload; return URL/id for itinerary thumbnail. | Add storage/validator middleware and stub when storage unavailable. |
| /api/auth/refresh | Reads refresh token from cookie only; no body schema. | Accept token via request body (and cookie for backward compatibility) and return new access token. | Add body DTO, fallback order, and tests. |
| /api/users/me/stats, /api/users/me/activity-logs | Not implemented; activity logs are admin-only. | Self-scope endpoints returning personal stats/logs. | Add routes/controller methods with proper authz and pagination. |
| /api/notifications | GET returns list; PATCH marks read. Payload is `{title?, message, data?}`. | Structured per event type (booking/payment/etc) with dynamic data fields. | Enforce typed payloads and emit notifications from booking/payment flows. |
| /api/chatbots/* | Accepts `{message, context?}`; returns canned text/optional fallback. | Should allow optional transport flag/stub payload for integration. | Add transport handling and document stub responses. |
